{% extends 'base.html' %}
{% block content %}
<div class="row g-4">
  <!-- Sidebar for multi-job selection (future) -->
  <div class="col-lg-3 d-none d-lg-block">
    <div class="modern-card p-3 mb-4 shadow-sm">
      <h5 class="fw-bold text-primary mb-3">Job Descriptions</h5>
      <ul class="list-group list-group-flush mb-2" id="job-list">
        <li class="list-group-item active">Current Job</li>
        <!-- Future: List other jobs here for multi-job matching -->
      </ul>
      <button class="btn btn-outline-primary w-100 mt-2" disabled>Add Job</button>
    </div>
  </div>
  <!-- Main dashboard area -->
  <div class="col-lg-9">
    <div class="row g-4">
      <div class="col-12 text-end mb-2">
        <a href="{{ url_for('main.download_report') }}" class="btn btn-success btn-lg shadow-sm"><i class="bi bi-download"></i> Download PDF Report</a>
      </div>
      <!-- Visual Analytics -->
      <div class="col-12">
        <div class="modern-card p-4 mb-4 shadow-lg" style="background: linear-gradient(90deg, #f0f4ff 0%, #f8fafc 100%);">
          <div class="d-flex align-items-center mb-3">
            <i class="bi bi-bar-chart-fill text-primary fs-2 me-2"></i>
            <h4 class="fw-bold text-success mb-0">Visual Analytics</h4>
          </div>
          <hr class="mb-4">
          <div class="row">
            <div class="col-md-6 mb-3">
              <div class="mb-2 text-center fw-semibold text-secondary" style="font-size:1.1rem;">Matched vs. Missing Keywords</div>
              <canvas id="skillsPieChart" height="180"></canvas>
            </div>
            <div class="col-md-6 mb-3">
              <div class="mb-2 text-center fw-semibold text-secondary" style="font-size:1.1rem;">Resume Score</div>
              <canvas id="matchScoreGauge" height="180"></canvas>
            </div>
          </div>
        </div>
      </div>
      <!-- ATS Optimization Report -->
      <div class="col-12">
        <div class="modern-card p-4 mb-4 shadow-lg" style="background: linear-gradient(90deg, #fffbe6 0%, #f8fafc 100%);">
          <div class="d-flex align-items-center mb-3">
            <i class="bi bi-shield-check text-warning fs-2 me-2"></i>
            <h4 class="fw-bold text-warning mb-0">ATS Optimization Report</h4>
          </div>
          <hr class="mb-4">
          <ul class="list-group mb-3">
            {% for label, desc in ats_report.criteria %}
              {% if label in ats_report.issues %}
                <li class="list-group-item d-flex align-items-center bg-light text-danger">
                  <i class="bi bi-x-circle-fill me-2"></i>
                  <span><b>{{ label }}</b>: {{ desc }}</span>
                  <span class="badge bg-danger ms-auto">Needs Improvement</span>
                </li>
              {% else %}
                <li class="list-group-item d-flex align-items-center text-success">
                  <i class="bi bi-check-circle-fill me-2"></i>
                  <span><b>{{ label }}</b>: {{ desc }}</span>
                  <span class="badge bg-success ms-auto">Pass</span>
                </li>
              {% endif %}
            {% endfor %}
          </ul>
          {% if ats_report.suggestions %}
            <div class="alert alert-warning">
              <b>Suggestions:</b>
              <ul class="mb-0">
                {% for s in ats_report.suggestions %}
                  <li>{{ s }}</li>
                {% endfor %}
              </ul>
            </div>
          {% else %}
            <div class="alert alert-success mb-0">Your resume is highly ATS compatible!</div>
          {% endif %}
        </div>
      </div>
      <!-- AI Resume Review Report -->
      <div class="col-12">
        <div class="modern-card p-4 mb-4 shadow-lg">
          <h3 class="fw-bold text-primary mb-4"><i class="bi bi-clipboard-check me-2"></i>AI Resume Review Report (Based on JD Match)</h3>
          <!-- 1. Candidate Summary -->
          <div class="mb-4">
            <h5 class="fw-bold text-secondary mb-2"><i class="bi bi-person-badge me-2"></i>Candidate Summary</h5>
            <div class="ps-2">{{ summary|safe }}</div>
          </div>
          <!-- 2. Job Description Matching Score -->
          <div class="mb-4">
            <h5 class="fw-bold text-secondary mb-2"><i class="bi bi-percent me-2"></i>Job Description Matching Score</h5>
            <div class="ps-2 mb-2">
              <span class="fs-3 fw-bold text-success">{{ fit_score }}%</span>
              <span class="ms-2">â€“
                {% if fit_score >= 85 %}
                  <span class="badge bg-success">Strong Fit</span>
                {% elif fit_score >= 70 %}
                  <span class="badge bg-warning text-dark">Moderate Fit</span>
                {% else %}
                  <span class="badge bg-danger">Low Fit</span>
                {% endif %}
              </span>
            </div>
            <!-- Optional: Scoring Breakdown (static example, replace with dynamic if available) -->
            <div class="ps-2">
              <ul class="list-unstyled mb-0">
                <li><b>Technical Skills Match:</b> <span class="text-primary">8/10</span></li>
                <li><b>Relevant Experience:</b> <span class="text-primary">7/10</span></li>
                <li><b>Soft Skills Match:</b> <span class="text-primary">6/10</span></li>
                <li><b>Project Relevance:</b> <span class="text-primary">8/10</span></li>
                <li><b>Education Alignment:</b> <span class="text-primary">9/10</span></li>
              </ul>
            </div>
          </div>
          <!-- 3. Skill Match Analysis -->
          <div class="mb-4">
            <h5 class="fw-bold text-secondary mb-2"><i class="bi bi-kanban me-2"></i>Skill Match Analysis</h5>
            <div class="table-responsive">
              <table class="table table-bordered align-middle">
                <thead class="table-light">
                  <tr>
                    <th>Skill from JD</th>
                    <th>Found in Resume?</th>
                    <th>Comments</th>
                  </tr>
                </thead>
                <tbody>
                  {% for skill in matched_skills %}
                  <tr>
                    <td>{{ skill }}</td>
                    <td><span class="text-success fw-bold"><i class="bi bi-check-circle-fill"></i> Yes</span></td>
                    <td>Mentioned in resume</td>
                  </tr>
                  {% endfor %}
                  {% for skill in missing_skills %}
                  <tr>
                    <td>{{ skill }}</td>
                    <td><span class="text-danger fw-bold"><i class="bi bi-x-circle-fill"></i> No</span></td>
                    <td>Not found</td>
                  </tr>
                  {% endfor %}
                  {% if not matched_skills and not missing_skills %}
                  <tr>
                    <td colspan="3" class="text-muted">No skills found for analysis.</td>
                  </tr>
                  {% endif %}
                </tbody>
              </table>
            </div>
          </div>
          <!-- 4. Experience Match Analysis -->
          <div class="mb-4">
            <h5 class="fw-bold text-secondary mb-2"><i class="bi bi-briefcase me-2"></i>Experience Match Analysis</h5>
            <div class="ps-2">
              {% if improvements and improvements[0] %}
                <div>{{ improvements[0]|safe }}</div>
              {% else %}
                <span class="text-muted">No experience analysis available.</span>
              {% endif %}
            </div>
          </div>
          <!-- 5. Red Flags / Gaps -->
          <div class="mb-4">
            <h5 class="fw-bold text-secondary mb-2"><i class="bi bi-exclamation-triangle me-2"></i>Red Flags / Gaps</h5>
            <div class="ps-2">
              {% if improvements and improvements[0] %}
                {# Ideally, parse and extract gaps from improvements[0] if structured. For now, show as-is. #}
                <div>{{ improvements[0]|safe }}</div>
              {% else %}
                <span class="text-muted">No gaps detected.</span>
              {% endif %}
            </div>
          </div>
          <!-- 6. Strengths -->
          <div class="mb-4">
            <h5 class="fw-bold text-secondary mb-2"><i class="bi bi-star-fill me-2"></i>Strengths</h5>
            <div class="ps-2">
              {% if improvements and improvements[0] %}
                <div>{{ improvements[0]|safe }}</div>
              {% else %}
                <span class="text-muted">No strengths detected.</span>
              {% endif %}
            </div>
          </div>
          <!-- 7. Recommendations for Improvement -->
          <div class="mb-4">
            <h5 class="fw-bold text-secondary mb-2"><i class="bi bi-lightbulb me-2"></i>Recommendations for Improvement</h5>
            <div class="ps-2">
              {% if improvements and improvements[0] %}
                <div>{{ improvements[0]|safe }}</div>
              {% else %}
                <span class="text-muted">No recommendations available.</span>
              {% endif %}
            </div>
          </div>
          <!-- 8. Final Verdict -->
          <div class="mb-2">
            <h5 class="fw-bold text-secondary mb-2"><i class="bi bi-flag me-2"></i>Final Verdict</h5>
            <div class="ps-2">
              {% if improvements and improvements[0] %}
                <div>{{ improvements[0]|safe }}</div>
              {% else %}
                <span class="text-muted">No verdict available.</span>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    <div class="text-end mt-3">
      <a href="/" class="btn btn-outline-primary btn-lg"><i class="bi bi-arrow-left"></i> Back</a>
    </div>
  </div>
</div>
<!-- Inject analytics data for JS -->
<script>
window.matchedSkills = {{ matched_skills|tojson|safe }};
window.missingSkills = {{ missing_skills|tojson|safe }};
window.fitScore = {{ fit_score|tojson|safe }};
</script>
<!-- Chart.js and word cloud placeholder scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.js"></script>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %} 